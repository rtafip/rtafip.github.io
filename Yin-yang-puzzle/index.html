<!DOCTYPE html><html lang="en-US"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 阴阳谜题 · 拖鞋党的拖鞋摊</title><meta name="description" content="阴阳谜题 - 拖鞋党"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://en.ors-sro.com/atom.xml" title="拖鞋党的拖鞋摊"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/icon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/rss/" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">阴阳谜题</h1><div class="post-info">Jan 15, 2017</div><div class="post-content"><p>我又从你的<ruby>未来<rt>世界</rt></ruby>回来。</p>
<a id="more"></a>
<h2 id="开门见山">开门见山</h2><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">yin</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\@</span>)</span> cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span></span><br><span class="line">       <span class="list">(<span class="keyword">yang</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\*</span>)</span> cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span>)</span></span><br><span class="line">    <span class="list">(<span class="keyword">yin</span> yang)</span>)</span></span><br></pre></td></tr></table></figure>
<p>这段代码的输出是什么呢？如果你的回答是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@*@**@***@****@...</span><br></pre></td></tr></table></figure>
<p>那么你真的很厉害啊。下面的废话就不用看了。到此为止。</p>
<p>如果你的回答不是那样，那么也没关系，毕竟这只是一段代码，不理解也不影响明天太阳升起。</p>
<p>如果你执意要理解，那么请先学习 Scheme 的基本语法之后再来挑战。Bye~</p>
<h2 id="立入禁止">立入禁止</h2><p>好吧。如果你在没有相关基础的情况下还要尝试的话很可能看不懂，毕竟我只是抱着玩的心态随便讲讲啊。看不懂才是自然的，看得懂就逆天了。</p>
<p>坑爹提示：以下内容配合 <a href="/Continuation-passing-style">CPS</a> 和 <a href="/Call-with-current-continuation">Call/cc</a> 食用更佳哦。</p>
<h2 id="无限轮回">无限轮回</h2><p>先讲一下 Scheme 的 <code>let*</code> 变量绑定。这个比较简单，看一个例子就明白了。</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">a</span> <span class="number">1</span>)</span>           <span class="comment">; a = 1</span></span><br><span class="line">       <span class="list">(<span class="keyword">b</span> <span class="list">(<span class="keyword"><span class="built_in">+</span></span> a <span class="number">1</span>)</span>)</span>)</span>    <span class="comment">; b = a + 1 = 2</span></span><br><span class="line">      <span class="list">(<span class="keyword"><span class="built_in">+</span></span> a b)</span>)</span>         <span class="comment">; a + b = 1 + 2 = 3</span></span><br><span class="line"><span class="comment">; =&gt; 3</span></span><br></pre></td></tr></table></figure>
<p>阴阳谜题的代码结构类似，忽略细节是这样的</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">yin</span>            <span class="comment">; yin = xxx</span></span><br><span class="line">         <span class="comment">; ...         ; 你会回来看的</span></span><br><span class="line">       <span class="list">(<span class="keyword">yang</span>           <span class="comment">; yang = yyy</span></span><br><span class="line">         <span class="comment">; ...         ; 你还会回来看的</span></span><br><span class="line">    <span class="list">(<span class="keyword">yin</span> yang)</span>)</span></span></span></span></span><br></pre></td></tr></table></figure>
<p>接着看 <code>yin</code> 和 <code>yang</code> 赋了什么值。</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">yin</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\@</span>)</span> cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span></span><br><span class="line">       <span class="list">(<span class="keyword">yang</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\*</span>)</span> cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span>)</span></span><br><span class="line">    <span class="list">(<span class="keyword">yin</span> yang)</span>)</span></span><br></pre></td></tr></table></figure>
<p>你可能会觉得这一长串是什么鬼。别急慢慢来。首先单独拎出来</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\@</span>)</span> cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span> <span class="comment">; yin 的赋值</span></span><br></pre></td></tr></table></figure>
<p>这个 <code>lambda</code> 是 Scheme 定义匿名函数的方式。</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;(lambda (参数列表) </span></span><br><span class="line"><span class="comment">;        (函数体))</span></span><br><span class="line"><span class="comment">; 定义匿名函数 function (x) &#123;return x+1;&#125; </span></span><br><span class="line"><span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">x</span>)</span></span><br><span class="line">        <span class="list">(<span class="keyword"><span class="built_in">+</span></span> x <span class="number">1</span>)</span>)</span> <span class="comment">; Scheme 返回值为最后一个表达式的计算结果。</span></span><br><span class="line"><span class="comment">;; 给匿名函数传递参数</span></span><br><span class="line"><span class="comment">;((lambda (参数列表) </span></span><br><span class="line"><span class="comment">;         (函数体)) 参数)</span></span><br><span class="line"><span class="comment">; 给匿名函数 (function(x) &#123;return x+1;&#125;)(1) 传递参数 1</span></span><br><span class="line"><span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">x</span>)</span></span><br><span class="line">         <span class="list">(<span class="keyword"><span class="built_in">+</span></span> x <span class="number">1</span>)</span>)</span>      <span class="number">1</span>)</span></span><br></pre></td></tr></table></figure>
<p>回到之前的代码，重新排版一下</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> </span><br><span class="line">         <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\@</span>)</span> </span><br><span class="line">         cc)</span>                <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span></span><br></pre></td></tr></table></figure>
<p>所以这个函数做了两件事。一是显示 <code>@</code> ，而是原封不动地返回接收的参数 <code>cc</code> 。</p>
<p>这个匿名函数还接收了参数，参数是</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span></span><br></pre></td></tr></table></figure>
<p>这个 <code>call-with-current-continuation</code> 是 Scheme 的一个特殊函数，返回一个 continuation 。简称为 Call/cc</p>
<p>详情请移步 <a href="/Call-with-current-continuation">Call/cc</a> 。</p>
<p>Call/cc 给匿名函数传了一个 continuation 。</p>
<p>这个匿名函数的作用是原封不动的返回接收到的参数。 </p>
<p>所以这句话返回一个 continuation 。</p>
<p>如果你还没有看上述链接，可以简单地认为这里做了个标记。使用这个标记，相当于 <code>goto</code> 回到这句话执行结束的位置。</p>
<p>只有调用 Call/cc 才会产生新的 continuation 。调用 continuation 导致 Call/cc 返回，不产生新的 continuation。</p>
<p>为了描述方便，在 Call/cc 处分别做标记。</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">yin</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> </span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\@</span>)</span> <span class="comment">; 输出 @</span></span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span> <span class="comment">;; 生成 cc0 因为调用了 Call/cc</span></span><br><span class="line">       <span class="comment">; 输出为 @</span></span><br><span class="line">       <span class="comment">; yin = cc0</span></span><br><span class="line">       <span class="comment">; yang = ???</span></span><br><span class="line">       <span class="comment">; 继续往下执行</span></span><br><span class="line">       <span class="list">(<span class="keyword">yang</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> </span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\*</span>)</span> <span class="comment">; 输出 *</span></span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span>)</span> <span class="comment">;; 生成 cc1 因为调用了 Call/cc</span></span><br><span class="line">      <span class="comment">; 输出为 @*</span></span><br><span class="line">      <span class="comment">; yin = cc0      &lt;- 上面赋值为 cc0</span></span><br><span class="line">      <span class="comment">; yang = cc1</span></span><br><span class="line">    <span class="list">(<span class="keyword">yin</span> yang)</span>)</span> <span class="comment">; (cc0 cc1)</span></span><br></pre></td></tr></table></figure>
<p>这是一开始的赋值情况。最后执行 <code>(yin yang)</code> 代入值为 <code>(cc0 cc1)</code> 。</p>
<p>这是什么意思呢。</p>
<p>上面说过了，调用标记相当于 <code>goto</code> 回到标记处，这个 <code>goto</code> 比较特殊可以把接收的参数带回去。</p>
<p>所以回到 cc0 处也就是</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">yin</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="comment">; 接收的参数是 Call/cc 返回的 cc1</span></span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\@</span>)</span> </span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span> <span class="comment">;; 这里是 cc0 。Call/cc 返回 cc1</span></span><br><span class="line">       <span class="comment">;...</span></span><br><span class="line">    )</span></span></span><br></pre></td></tr></table></figure>
<p>然后 Call/cc 接收到 cc1 ，返回 cc1 ，传给匿名函数。</p>
<p>这里需要注意的是给匿名函数传递参数首先要计算参数的值，也就是先计算 Call/cc ，得到返回值后再计算匿名函数。</p>
<p>所以相当于 <code>goto</code> 回到了赋值开始的地方</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">yin</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="comment">; 接收的参数是 Call/cc 返回的 cc1</span></span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\@</span>)</span> <span class="comment">; 输出 @</span></span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span> <span class="comment">;; 这里是 cc0 。Call/cc 返回 cc1</span></span><br><span class="line">       <span class="comment">; 输出为 @*@    &lt;- 之前已经输出了 @* </span></span><br><span class="line">       <span class="comment">; yin = cc1    &lt;- 这里赋值为匿名函数的返回值 cc1</span></span><br><span class="line">       <span class="comment">; yang = ???</span></span><br><span class="line">       <span class="comment">; 继续往下执行</span></span><br><span class="line">       <span class="list">(<span class="keyword">yang</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> </span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\*</span>)</span> <span class="comment">; 输出 *</span></span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span>)</span> <span class="comment">;; cc2 因为调用了 Call/cc</span></span><br><span class="line">      <span class="comment">; 输出为 @*@*</span></span><br><span class="line">      <span class="comment">; yin = cc1      &lt;- 上面赋值为 cc1</span></span><br><span class="line">      <span class="comment">; yang = cc2</span></span><br><span class="line">    <span class="list">(<span class="keyword">yin</span> yang)</span>)</span> <span class="comment">; (cc1 cc2)</span></span><br></pre></td></tr></table></figure>
<p>同样地，调用 <code>(cc1 cc2)</code> 会将 cc2 带到 cc1 处。cc1 处在哪呢？在上面给 <code>yang</code> 赋值的位置。</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">yin</span></span><br><span class="line">		<span class="comment">;...</span></span><br><span class="line">       <span class="list">(<span class="keyword">yang</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="comment">; 接收的参数是 Call/cc 返回的 cc2</span></span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\*</span>)</span> <span class="comment">; 输出 *</span></span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span>)</span> <span class="comment">;; 这里是 cc1 。Call/cc 返回 cc2</span></span><br><span class="line">      <span class="comment">; 输出为 @*@**    &lt;- 上面已经输出 @*@*</span></span><br><span class="line">      <span class="comment">; yin = cc0      &lt;- cc1 处的 yin 为 cc0</span></span><br><span class="line">      <span class="comment">; yang = cc2     &lt;- 命运改写了，这次 yang 被赋值为 cc2</span></span><br><span class="line">    <span class="list">(<span class="keyword">yin</span> yang)</span>)</span> <span class="comment">; (cc0 cc2)</span></span></span><br></pre></td></tr></table></figure>
<p>同样地，调用 <code>(cc0 cc2)</code> 会将 cc2 带到 cc0 处。cc0 处在哪呢？在上面给 <code>yin</code> 赋值的位置。</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">yin</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="comment">; 接收的参数是 Call/cc 返回的 cc2</span></span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\@</span>)</span> <span class="comment">; 输出 @</span></span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span> <span class="comment">;; 这里是 cc0 。Call/cc 返回 cc2</span></span><br><span class="line">       <span class="comment">; 输出为 @*@**@ &lt;- 上面已经输出 @*@**</span></span><br><span class="line">       <span class="comment">; yin = cc2    &lt;- 命运改写了，这次 yin 被赋值为 cc2</span></span><br><span class="line">       <span class="comment">; yang = ???</span></span><br><span class="line">       <span class="comment">; 继续往下执行</span></span><br><span class="line">       <span class="list">(<span class="keyword">yang</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> </span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\*</span>)</span> <span class="comment">; 输出 *</span></span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span>)</span> <span class="comment">;; cc3 因为调用了 Call/cc</span></span><br><span class="line">      <span class="comment">; 输出为 @*@**@*</span></span><br><span class="line">      <span class="comment">; yin = cc2      &lt;- 上面赋值为 cc2</span></span><br><span class="line">      <span class="comment">; yang = cc3</span></span><br><span class="line">    <span class="list">(<span class="keyword">yin</span> yang)</span>)</span> <span class="comment">; (cc2 cc3)</span></span><br></pre></td></tr></table></figure>
<p>同样地，调用 <code>(cc2 cc3)</code> 会将 cc3 带到 cc2 处。cc2 处在哪呢？在上面给 <code>yang</code> 赋值的位置。</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">yin</span></span><br><span class="line">		<span class="comment">; ...</span></span><br><span class="line">       <span class="list">(<span class="keyword">yang</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="comment">; 接收的参数是 Call/cc 返回的 cc3</span></span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\*</span>)</span> <span class="comment">; 输出 *</span></span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span>)</span> <span class="comment">;; 这里是 cc2 。Call/cc 返回 cc3</span></span><br><span class="line">      <span class="comment">; 输出为 @*@**@** &lt;- 上面已经输出 @*@**@*</span></span><br><span class="line">      <span class="comment">; yin = cc1      &lt;- cc2 处的 yin 为 cc1</span></span><br><span class="line">      <span class="comment">; yang = cc3     &lt;- 命运改写了，这次 yang 被赋值为 cc3</span></span><br><span class="line">    <span class="list">(<span class="keyword">yin</span> yang)</span>)</span> <span class="comment">; (cc1 cc3)</span></span></span><br></pre></td></tr></table></figure>
<p>同样地，调用 <code>(cc1 cc3)</code> 会将 cc3 带到 cc1 处。cc1 处在哪呢？在上面给 <code>yang</code> 赋值的位置。</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">yin</span></span><br><span class="line">		<span class="comment">;...</span></span><br><span class="line">       <span class="list">(<span class="keyword">yang</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="comment">; 接收的参数是 Call/cc 返回的 cc3</span></span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\*</span>)</span> <span class="comment">; 输出 *</span></span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span>)</span> <span class="comment">;; 这里是 cc1 。Call/cc 返回 cc3</span></span><br><span class="line">      <span class="comment">; 输出为 @*@**@*** &lt;- 上面已经输出 @*@**@**</span></span><br><span class="line">      <span class="comment">; yin = cc0      &lt;- cc1 处的 yin 为 cc0</span></span><br><span class="line">      <span class="comment">; yang = cc3     &lt;- 命运改写了，这次 yang 被赋值为 cc3</span></span><br><span class="line">    <span class="list">(<span class="keyword">yin</span> yang)</span>)</span> <span class="comment">; (cc0 cc3)</span></span></span><br></pre></td></tr></table></figure>
<p>同样地，调用 <code>(cc0 cc3)</code> 会将 cc3 带到 cc0 处。cc0 处在哪呢？在上面给 <code>yin</code> 赋值的位置。</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">yin</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> <span class="comment">; 接收的参数是 Call/cc 返回的 cc3</span></span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\@</span>)</span> <span class="comment">; 输出 @</span></span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span> <span class="comment">;; 这里是 cc0 。Call/cc 返回 cc3</span></span><br><span class="line">       <span class="comment">; 输出为 @*@**@***@ &lt;- 上面已经输出 @*@**@***</span></span><br><span class="line">       <span class="comment">; yin = cc3    &lt;- 命运改写了，这次 yin 被赋值为 cc3</span></span><br><span class="line">       <span class="comment">; yang = ???</span></span><br><span class="line">       <span class="comment">; 继续往下执行</span></span><br><span class="line">       <span class="list">(<span class="keyword">yang</span></span><br><span class="line">         <span class="list">(<span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">cc</span>)</span> </span><br><span class="line">                  <span class="list">(<span class="keyword"><span class="built_in">display</span></span> <span class="literal">#\*</span>)</span> <span class="comment">; 输出 *</span></span><br><span class="line">                  cc)</span> <span class="list">(<span class="keyword"><span class="built_in">call-with-current-continuation</span></span> <span class="list">(<span class="keyword"><span class="built_in">lambda</span></span> <span class="list">(<span class="keyword">c</span>)</span> c)</span>)</span>)</span>)</span>)</span> <span class="comment">;; cc4 因为调用了 Call/cc</span></span><br><span class="line">      <span class="comment">; 输出为 @*@**@***@*</span></span><br><span class="line">      <span class="comment">; yin = cc3      &lt;- 上面赋值为 cc3</span></span><br><span class="line">      <span class="comment">; yang = cc4</span></span><br><span class="line">    <span class="list">(<span class="keyword">yin</span> yang)</span>)</span> <span class="comment">; (cc3 cc4)</span></span><br></pre></td></tr></table></figure>
<p>同样地，调用 <code>(cc3 cc4)</code> ……</p>
<p>会一直按上述规律一直无限循环下去。</p>
<h2 id="最后">最后</h2><p>没想到有一天会写阴阳谜题，因为相关的前置基础太多了，写完得多累。但是写了 CPS 就自然写 Call/cc ，写了 Call/cc 写阴阳谜题就是水到渠成的了。再重申一次，我只是抱着玩的心态随便讲讲啊。看不懂才是自然的，看得懂就逆天了（逃</p>
</div></article></div></main><footer><div class="paginator"><a href="/Learn-you-a-Haskell-for-great-good-notes/" class="prev">上一篇</a><a href="/Call-with-current-continuation/" class="next">下一篇</a></div><div class="copyright"><p>© 2014 - 2018 <a href="http://en.ors-sro.com">拖鞋党</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p><p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold; animation: breathe 3s infinite">Coding Pages</a></p></div></footer></div><script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
    inlineMath: [ ['$','$'], ["\\\(","\\)"] ],
    processEscapes: true
    }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});
</script></body></html>